*taal.txt* LLM assistance for improving grammar and spelling

------------------------------------------------------------------------------
                                                                          *Taal*

FEATURES

- Suggests grammar and spelling improvements. This feature is language 
  agnostic, as long as the chosen LLM is capable of that.

- Offers a word-by-word diff of the original text and the suggested
  improvements.

- Applies improvements all at once, or on a one-to-one basis.

- Recognizes the language the text is written in and sets the correct
  |spelllang| option.
  
- Interacts with the LLM using a user command and the selected text.

- Supports three LLMs: Claude, Gemini, OpenAI-responses.

DEPENDENCIES

- nvim-lua/plenary.nvim
  Pleanary's curl is used to contact LLMs

INSTALLATION

This module needs to be set up with `require('taal').setup({})`. The setup arg
`{}` is optional and can be a custom config table, to overwrite the defaults.
Calling the setup function, with or without a table, is mandatory.

API keys ~

The LLMs that are used need an API key. These keys should be made available
via an environment variable:

- Claude: `{{CLAUDE_API_KEY}}`
- Gemini: `{{GEMINI_API_KEY}}`
- OpenAI_responses: `{{OPENAI_API_KEY}}`

Config options ~

The user configuration table supports these fields:
- {log_level} (`'trace'|'info'|'debug'|'error'`, default: `'error'`)
- {timeout} (`integer`, default: `6000`) timeout for LLM requests in ms
- {template_fn} (`fn(command: string, default_template: table, user_input: table)`) 
  - `command` can be <grammar>, <interact> or <language> and refers to the
    user command that triggered this call
  - `default_template` the template that is the default choice for this `command` 
  - `user_input` an array (table) of user input. These values will replace the
    placeholders in the template to be returned.

  Return: (`table`) a table with these elements:
  - <system>? (`string`) message to set the stage for the LLM
  - <examples>? (`table`) an array of alternating user and assistant messages
    that serve as an example
  - <message> (`string`) the message that is sent to the LLM. This message can
    hold placeholders that will be replaced by `user_input`. For the commands
    <grammar> and <language> `user_input` has one item (the text under cursor), 
    for <interact> it has two items; the command the user is prompted for and
    the selected text in visual mode.

  Note: The returned template will be processed by the relevant adapter 
  before it is send to the LLM. The returned template must therefore adhere 
  to the above structure. 

  See: lua/taal/templates for the default templates.
- {adapters} (`table<'claude'|'gemini'|'openai', table<'url',string>>`) url
  per adapter
- {adapter} (`'claude'|'gemini'|'openai'`, default: `'gemini'`) default
  adapter for all requests
- {model} (`string`, default: `'gemini-2.5-flash'`) default model for all requests
- {commands} (`table<'grammar'|'interact'|'setspelllang', `
  `table<[ADAPTER|MODEL],[VALUE]>>`) overrides the default adapter and model
  per command

Default config ~

The default config is:
>lua
  {
    log_level = "error",
    timeout = 6000,

    adapters = {
      claude = {
        url = "https://api.anthropic.com",
      },
      gemini = {
        url = "https://generativelanguage.googleapis.com",
      },
      openai_responses = {
        url = "https://api.openai.com",
      },
    },

    adapter = "gemini",
    model = "gemini-2.5-flash",

    commands = {
      improve_grammar = {
        adapter = nil,
        model = nil,
      },
      suggest_grammar = {
        adapter = nil,
        model = nil,
      },
      set_spelllang = {
        adapter = nil,
        model = nil,
      },
      interact = {
        adapter = nil,
        model = nil,
      },
    },
  }
<
Example config ~

This example uses Gemini and the model gemini-2.5-flash as the default LLM (because it
is not changed), except for the interact command. For that command it will use
Claude with the model claude-sonnet-4-5-20250929.
>lua
  { 
    commands = {
      interact = { 
	adapter="claude", model="claude-sonnet-4-5-20250929", 
      }
    }
  }

COMMANDS

TaalApplySuggestion                                       *taal-apply-suggestion*
    Applies the suggested improvement of the text with an error currently
    under cursor. 

TaalGrammar                                                        *taal-grammar*
    Checks grammar and spelling of the line of text currently under cursor. 
    Grammar and spelling errors are highlighted with the 'TaalIssue' highlight group.
    This command takes two optional arguments:
    - <inlay> Shows grammar and spelling improvements as inlay hints using the 
      'TaalInlay' highlight group.
    - <scratch> Writes the complete improved line in a scratch buffer in a vertical
      split.

TaalHover                                                            *taal-hover*
    Shows the grammar improvement of the text with an error currently under
    cursor in a popup.

TaalInteract                                                       *taal-interact*
    Asks the user for a prompt and sends this, together with the selected text
    to the LLM. Use in Visual Mode. Note that this ex command cannot be used
    by using `:TaalInteract` as using the colon will switch Neovim back to
    normal mode. Map this command to a key using `<Cmd>TaalInteract<Cr>`
    instead.

TaalSetSpelllang                                             *taal-set-spelllang*
    Recognizes the language of the text under cursor and sets the spelling
    language accordingly using the 'spelllang' option.

HIGHLIGHT GROUPS

- 'TaalIssue' - grammar error
- 'TaalImprovement' - suggested improvement
- 'TaalInlay' - inlay hint with suggested improvement

LOG

A log file is written to the |standard-path| log directory.

vim:tw=78:ts=8:noet:ft=help:norl:
